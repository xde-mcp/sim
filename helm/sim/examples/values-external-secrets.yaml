# External Secrets Operator integration for Sim
# Syncs secrets from Azure Key Vault, AWS Secrets Manager, HashiCorp Vault, etc.

# Prerequisites:
# 1. Install ESO: helm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace
# 2. Create a SecretStore/ClusterSecretStore for your provider (see examples at bottom of file)

externalSecrets:
  enabled: true
  apiVersion: "v1"
  refreshInterval: "1h"
  secretStoreRef:
    name: "sim-secret-store"
    kind: "ClusterSecretStore"
  remoteRefs:
    app:
      BETTER_AUTH_SECRET: "sim/app/better-auth-secret"
      ENCRYPTION_KEY: "sim/app/encryption-key"
      INTERNAL_API_SECRET: "sim/app/internal-api-secret"
      CRON_SECRET: "sim/app/cron-secret"
      API_ENCRYPTION_KEY: "sim/app/api-encryption-key"
    postgresql:
      password: "sim/postgresql/password"

app:
  enabled: true
  replicaCount: 2
  env:
    NEXT_PUBLIC_APP_URL: "https://sim.example.com"
    BETTER_AUTH_URL: "https://sim.example.com"
    NEXT_PUBLIC_SOCKET_URL: "wss://sim-ws.example.com"
    NODE_ENV: "production"

realtime:
  enabled: true
  replicaCount: 2
  env:
    NEXT_PUBLIC_APP_URL: "https://sim.example.com"
    BETTER_AUTH_URL: "https://sim.example.com"
    NEXT_PUBLIC_SOCKET_URL: "wss://sim-ws.example.com"
    ALLOWED_ORIGINS: "https://sim.example.com"
    NODE_ENV: "production"

postgresql:
  enabled: true
  auth:
    username: postgres
    database: sim

# ---
# SecretStore Examples (apply one of these to your cluster before installing)
# ---

# Azure Key Vault (Workload Identity):
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     azurekv:
#       authType: WorkloadIdentity
#       vaultUrl: "https://your-keyvault.vault.azure.net"
#       serviceAccountRef:
#         name: external-secrets-sa
#         namespace: external-secrets

# AWS Secrets Manager (IRSA):
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     aws:
#       service: SecretsManager
#       region: us-east-1
#       role: arn:aws:iam::123456789012:role/external-secrets-role

# HashiCorp Vault (Kubernetes Auth):
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     vault:
#       server: "https://vault.example.com"
#       path: "secret"
#       version: "v2"
#       auth:
#         kubernetes:
#           mountPath: "kubernetes"
#           role: "external-secrets"
