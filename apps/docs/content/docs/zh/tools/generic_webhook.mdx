---
title: Webhook
description: 通过配置自定义 webhook，从任何服务接收 webhook。
---

import { BlockInfoCard } from "@/components/ui/block-info-card"
import { Image } from '@/components/ui/image'

<BlockInfoCard 
  type="generic_webhook"
  color="#10B981"
  icon={true}
  iconSvg={`<svg className="block-icon"
      
      fill='currentColor'
      
      
      viewBox='0 0 24 24'
      xmlns='http://www.w3.org/2000/svg'
    >
      <path d='M17.974 7A4.967 4.967 0 0 0 18 6.5a5.5 5.5 0 1 0-8.672 4.491L7.18 15.114A2.428 2.428 0 0 0 6.496 15 2.5 2.5 0 1 0 9 17.496a2.36 2.36 0 0 0-.93-1.925l2.576-4.943-.41-.241A4.5 4.5 0 1 1 17 6.5a4.8 4.8 0 0 1-.022.452zM6.503 18.999a1.5 1.5 0 1 1 1.496-1.503A1.518 1.518 0 0 1 6.503 19zM18.5 12a5.735 5.735 0 0 0-1.453.157l-2.744-3.941A2.414 2.414 0 0 0 15 6.5a2.544 2.544 0 1 0-1.518 2.284l3.17 4.557.36-.13A4.267 4.267 0 0 1 18.5 13a4.5 4.5 0 1 1-.008 9h-.006a4.684 4.684 0 0 1-3.12-1.355l-.703.71A5.653 5.653 0 0 0 18.49 23h.011a5.5 5.5 0 0 0 0-11zM11 6.5A1.5 1.5 0 1 1 12.5 8 1.509 1.509 0 0 1 11 6.5zM18.5 20a2.5 2.5 0 1 0-2.447-3h-5.05l-.003.497A4.546 4.546 0 0 1 6.5 22 4.526 4.526 0 0 1 2 17.5a4.596 4.596 0 0 1 3.148-4.37l-.296-.954A5.606 5.606 0 0 0 1 17.5 5.532 5.532 0 0 0 6.5 23a5.573 5.573 0 0 0 5.478-5h4.08a2.487 2.487 0 0 0 2.442 2zm0-4a1.5 1.5 0 1 1-1.5 1.5 1.509 1.509 0 0 1 1.5-1.5z' />
      <path fill='none' d='M0 0h24v24H0z' />
    </svg>`}
/>

<div className="flex justify-center">
  <Image
    src="/static/blocks/webhook.png"
    alt="Webhook Block Configuration"
    width={500}
    height={400}
    className="my-6"
  />
</div>

## 概述

通用 Webhook 模块允许您接收来自任何外部服务的 webhook。这是一个灵活的触发器，可以处理任何 JSON 负载，非常适合与没有专用 Sim 模块的服务集成。

## 基本用法

### 简单直通模式

在未定义输入格式的情况下，webhook 会按原样传递整个请求正文：

```bash
curl -X POST https://sim.ai/api/webhooks/trigger/{webhook-path} \
  -H "Content-Type: application/json" \
  -H "X-Sim-Secret: your-secret" \
  -d '{
    "message": "Test webhook trigger",
    "data": {
      "key": "value"
    }
  }'
```

在下游模块中使用以下方式访问数据：
- `<webhook1.message>` → "测试 webhook 触发器"
- `<webhook1.data.key>` → "值"

### 结构化输入格式（可选）

定义输入模式以获取类型化字段，并启用高级功能，例如文件上传：

**输入格式配置：**

```json
[
  { "name": "message", "type": "string" },
  { "name": "priority", "type": "number" },
  { "name": "documents", "type": "files" }
]
```

**Webhook 请求：**

```bash
curl -X POST https://sim.ai/api/webhooks/trigger/{webhook-path} \
  -H "Content-Type: application/json" \
  -H "X-Sim-Secret: your-secret" \
  -d '{
    "message": "Invoice submission",
    "priority": 1,
    "documents": [
      {
        "type": "file",
        "data": "data:application/pdf;base64,JVBERi0xLjQK...",
        "name": "invoice.pdf",
        "mime": "application/pdf"
      }
    ]
  }'
```

## 文件上传

### 支持的文件格式

webhook 支持两种文件输入格式：

#### 1. Base64 编码文件
用于直接上传文件内容：

```json
{
  "documents": [
    {
      "type": "file",
      "data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgA...",
      "name": "screenshot.png",
      "mime": "image/png"
    }
  ]
}
```

- **最大大小**：每个文件 20MB
- **格式**：带有 base64 编码的标准数据 URL
- **存储**：文件上传到安全的执行存储

#### 2. URL 引用
用于传递现有文件 URL：

```json
{
  "documents": [
    {
      "type": "url",
      "data": "https://example.com/files/document.pdf",
      "name": "document.pdf",
      "mime": "application/pdf"
    }
  ]
}
```

### 在下游模块中访问文件

文件被处理为具有以下属性的 `UserFile` 对象：

```typescript
{
  id: string,          // Unique file identifier
  name: string,        // Original filename
  url: string,         // Presigned URL (valid for 5 minutes)
  size: number,        // File size in bytes
  type: string,        // MIME type
  key: string,         // Storage key
  uploadedAt: string,  // ISO timestamp
  expiresAt: string    // ISO timestamp (5 minutes)
}
```

**分块访问：**
- `<webhook1.documents[0].url>` → 下载 URL
- `<webhook1.documents[0].name>` → "invoice.pdf"
- `<webhook1.documents[0].size>` → 524288
- `<webhook1.documents[0].type>` → "application/pdf"

### 完整文件上传示例

```bash
# Create a base64-encoded file
echo "Hello World" | base64
# SGVsbG8gV29ybGQK

# Send webhook with file
curl -X POST https://sim.ai/api/webhooks/trigger/{webhook-path} \
  -H "Content-Type: application/json" \
  -H "X-Sim-Secret: your-secret" \
  -d '{
    "subject": "Document for review",
    "attachments": [
      {
        "type": "file",
        "data": "data:text/plain;base64,SGVsbG8gV29ybGQK",
        "name": "sample.txt",
        "mime": "text/plain"
      }
    ]
  }'
```

## 身份验证

### 配置身份验证（可选）

在 webhook 配置中：
1. 启用“需要身份验证”
2. 设置一个密钥令牌
3. 选择头类型：
   - **自定义头**: `X-Sim-Secret: your-token`
   - **授权 Bearer**: `Authorization: Bearer your-token`

### 使用身份验证

```bash
# With custom header
curl -X POST https://sim.ai/api/webhooks/trigger/{webhook-path} \
  -H "Content-Type: application/json" \
  -H "X-Sim-Secret: your-secret-token" \
  -d '{"message": "Authenticated request"}'

# With bearer token
curl -X POST https://sim.ai/api/webhooks/trigger/{webhook-path} \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-secret-token" \
  -d '{"message": "Authenticated request"}'
```

## 最佳实践

1. **使用输入格式定义结构**：当您知道预期的模式时，定义输入格式。这提供：
   - 类型验证
   - 编辑器中的更好自动完成
   - 文件上传功能

2. **身份验证**：在生产环境的 webhook 中始终启用身份验证，以防止未经授权的访问。

3. **文件大小限制**：将文件保持在 20MB 以下。对于更大的文件，请使用 URL 引用。

4. **文件过期**：下载的文件具有 5 分钟的 URL 过期时间。请及时处理，或如果需要更长时间，请将其存储在其他地方。

5. **错误处理**：Webhook 处理是异步的。请检查执行日志以获取错误信息。

6. **测试**：在部署前，使用编辑器中的“测试 Webhook”按钮验证您的配置。

## 使用场景

- **表单提交**：接收带有文件上传的自定义表单数据
- **第三方集成**：与发送 webhook 的服务（如 Stripe、GitHub 等）连接
- **文档处理**：接受来自外部系统的文档进行处理
- **事件通知**：接收来自各种来源的事件数据
- **自定义 API**：为您的应用程序构建自定义 API 端点

## 注意事项

- 类别：`triggers`
- 类型：`generic_webhook`
- **文件支持**：通过输入格式配置可用
- **最大文件大小**：每个文件 20MB
