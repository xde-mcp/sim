---
title: メモリー
description: 会話履歴を保存および取得
---

import { BlockInfoCard } from "@/components/ui/block-info-card"

<BlockInfoCard 
  type="memory"
  color="#F64F9E"
/>

## 概要

Memoryブロックはエージェントの会話履歴を保存します。各メモリは、提供する`conversationId`によって識別されます。複数のエージェントが同じ`conversationId`を使用することで、同じメモリを共有できます。

メモリにはユーザーとアシスタントのメッセージのみが保存されます。システムメッセージは保存されません。これらはAgentブロックで設定され、実行時にプレフィックスとして付加されます。

## ツール

### `memory_add`

メモリにメッセージを追加します。`conversationId`が存在しない場合は新しいメモリを作成し、既存のメモリがある場合は追加します。

#### 入力

| パラメータ | 型 | 必須 | 説明 |
| --------- | ---- | -------- | ----------- |
| `conversationId` | string | はい | 会話の一意の識別子（例：`user-123`、`session-abc`） |
| `role` | string | はい | メッセージの役割：`user`または`assistant` |
| `content` | string | はい | メッセージの内容 |

#### 出力

| パラメータ | 型 | 説明 |
| --------- | ---- | ----------- |
| `success` | boolean | 操作が成功したかどうか |
| `memories` | array | 更新されたメモリの配列 |
| `error` | string | 失敗した場合のエラーメッセージ |

### `memory_get`

会話IDによってメモリを取得します。

#### 入力

| パラメータ | 型 | 必須 | 説明 |
| --------- | ---- | -------- | ----------- |
| `conversationId` | string | はい | 会話の識別子 |

#### 出力

| パラメータ | 型 | 説明 |
| --------- | ---- | ----------- |
| `success` | boolean | 操作が成功したかどうか |
| `memories` | array | `role`と`content`を含むメッセージの配列 |
| `error` | string | 失敗した場合のエラーメッセージ |

### `memory_get_all`

現在のワークスペースのすべてのメモリを取得します。

#### 出力

| パラメータ | 型 | 説明 |
| --------- | ---- | ----------- |
| `success` | boolean | 操作が成功したかどうか |
| `memories` | array | `conversationId`と`data`フィールドを持つすべてのメモリオブジェクト |
| `error` | string | 失敗した場合のエラーメッセージ |

### `memory_delete`

会話IDによってメモリを削除します。

#### 入力

| パラメータ | 型 | 必須 | 説明 |
| --------- | ---- | -------- | ----------- |
| `conversationId` | string | はい | 削除する会話識別子 |

#### 出力

| パラメータ | 型 | 説明 |
| --------- | ---- | ----------- |
| `success` | boolean | 操作が成功したかどうか |
| `message` | string | 確認メッセージ |
| `error` | string | 失敗した場合のエラーメッセージ |

## エージェントメモリタイプ

エージェントブロックでメモリを使用する場合、会話履歴の管理方法を設定できます。

| タイプ | 説明 |
| ---- | ----------- |
| **完全な会話** | すべてのメッセージを保存し、モデルのコンテキストウィンドウによって制限されます（応答のための余地を残すために90%を使用） |
| **スライディングウィンドウ（メッセージ）** | 最後のNメッセージを保持します（デフォルト：10） |
| **スライディングウィンドウ（トークン）** | トークン制限内に収まるメッセージを保持します（デフォルト：4000） |

## 注意事項

- メモリはワークスペースごとにスコープされます。同じワークスペース内のワークフローはメモリストアを共有します
- 会話を分離するために一意の`conversationId`値を使用してください（例：セッションID、ユーザーID、またはUUID）
- システムメッセージはメモリではなく、エージェントブロック設定に属します
