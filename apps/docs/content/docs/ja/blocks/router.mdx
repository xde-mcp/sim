---
title: ルーター
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Step, Steps } from 'fumadocs-ui/components/steps'
import { Tab, Tabs } from 'fumadocs-ui/components/tabs'
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion'
import { Image } from '@/components/ui/image'
import { Video } from '@/components/ui/video'

ルーターブロックはAIを使用して、ワークフローが次にどのパスを取るべきかをインテリジェントに判断し、特定の条件やロジックに基づいてワークフローの実行をルーティングします。単純なルールを使用する条件ブロックとは異なり、ルーターブロックはコンテキストを理解し、コンテンツ分析に基づいてスマートなルーティング判断を行うことができます。

<div className="flex justify-center">
  <Image
    src="/static/blocks/router.png"
    alt="複数のパスを持つルーターブロック"
    width={500}
    height={400}
    className="my-6"
  />
</div>

## ルーター vs 条件ブロック

**ルーターを使用する場合：**
- AIを活用したコンテンツ分析が必要
- 非構造化または様々なコンテンツを扱う場合
- 意図ベースのルーティングが必要（例：「サポートチケットを部門にルーティング」）

**条件ブロックを使用する場合：**
- 単純なルールベースの判断で十分
- 構造化データまたは数値比較を扱う場合
- 高速で決定論的なルーティングが必要

## 設定オプション

### コンテンツ/プロンプト

ルーターがルーティング決定を行うために分析するコンテンツまたはプロンプト。これには以下が含まれます：

- ユーザーからの直接的な質問や入力
- 前のブロックからの出力
- システムが生成したメッセージ

### ターゲットブロック

ルーターが選択できる可能な宛先ブロック。ルーターは接続されたブロックを自動的に検出しますが、以下のこともできます：

- ルーティング精度を向上させるためにターゲットブロックの説明をカスタマイズする
- 各ターゲットブロックのルーティング基準を指定する
- 特定のブロックをルーティングターゲットとして考慮から除外する

### モデル選択

ルーティング決定を行うAIモデルを選択します：

**OpenAI**: GPT-4o, o1, o3, o4-mini, gpt-4.1  \
**Anthropic**: Claude 3.7 Sonnet \
**Google**: Gemini 2.5 Pro, Gemini 2.0 Flash \
**その他のプロバイダー**: Groq, Cerebras, xAI, DeepSeek \
**ローカルモデル**: Ollamaで実行されているすべてのモデル 

<div className="w-full max-w-2xl mx-auto overflow-hidden rounded-lg">
  <Video src="models.mp4" width={500} height={350} />
</div>

**推奨**: より正確なルーティング決定のために、GPT-4oやClaude 3.7 Sonnetなどの強力な推論能力を持つモデルを使用してください。

### APIキー

選択したLLMプロバイダーのAPIキー。これは安全に保存され、認証に使用されます。

### 結果へのアクセス

ルーターが決定を下した後、以下の出力にアクセスできます：

- **`<router.prompt>`**: 使用されたルーティングプロンプトの要約
- **`<router.selected_path>`**: 選択された宛先ブロックの詳細
- **`<router.tokens>`**: LLMからのトークン使用統計
- **`<router.cost>`**: ルーティングコールのコスト概要（入力、出力、合計）
- **`<router.model>`**: 意思決定に使用されたモデル


## 使用例

### カスタマーサポートの振り分け

<div className="mb-4 rounded-md border p-4">
  <h4 className="font-medium">シナリオ: サポートチケットを専門部署に振り分ける</h4>
  <ol className="list-decimal pl-5 text-sm">
    <li>ユーザーがフォームからサポートリクエストを送信</li>
    <li>ルーターがチケットの内容とコンテキストを分析</li>
    <li>技術的な問題 → エンジニアリングサポート担当者</li>
    <li>請求に関する質問 → 財務サポート担当者</li>
  </ol>
</div>

### コンテンツ分類

<div className="mb-4 rounded-md border p-4">
  <h4 className="font-medium">シナリオ: ユーザー生成コンテンツを分類して振り分ける</h4>
  <ol className="list-decimal pl-5 text-sm">
    <li>ユーザーがコンテンツやフィードバックを送信</li>
    <li>ルーターがコンテンツの種類と感情を分析</li>
    <li>機能リクエスト → プロダクトチームのワークフロー</li>
    <li>バグ報告 → 技術サポートワークフロー</li>
  </ol>
</div>

### リード評価

<div className="mb-4 rounded-md border p-4">
  <h4 className="font-medium">シナリオ: 評価基準に基づいてリードを振り分ける</h4>
  <ol className="list-decimal pl-5 text-sm">
    <li>フォームからリード情報を取得</li>
    <li>ルーターが企業規模、業界、ニーズを分析</li>
    <li>エンタープライズリード → カスタム価格設定を提供する営業チーム</li>
    <li>中小企業リード → セルフサービスのオンボーディングフロー</li>
  </ol>
</div>

## ベストプラクティス

- **明確なターゲット説明を提供する**: 具体的で詳細な説明でルーターが各送信先を選択するタイミングを理解できるようにする
- **特定のルーティング基準を使用する**: 各経路に明確な条件と例を定義して精度を向上させる
- **フォールバックパスを実装する**: 特定の経路が適切でない場合のデフォルト送信先を接続する
- **多様な入力でテストする**: ルーターが様々な入力タイプ、エッジケース、予期しないコンテンツを処理できることを確認する
- **ルーティングパフォーマンスを監視する**: ルーティング判断を定期的に確認し、実際の使用パターンに基づいて基準を改善する
- **適切なモデルを選択する**: 複雑なルーティング判断には強力な推論能力を持つモデルを使用する
